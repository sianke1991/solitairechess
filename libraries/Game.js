"use strict";/*@author sianke1991*/class Game{constructor(e,a,t){this._ordinal=e,this._name=a,this._snackbar=new Snackbar,this._board=new Board,this._boardHistory=new BoardHistory,this._rules=new Rules(KingCapturable.DEFAULT),this._moveHistory=new MoveHistory,this._solution=new MoveHistory,this._solutionReveality=!1,this._selectedSquare=null,this._targetSquares=[],this._selectedKingCapturable=KingCapturable.DEFAULT,this._selectedPiece=null,this._puzzleNumber=t,this._demoplayRecentTime=0}get ordinal(){return this._ordinal}get name(){return this._name}static values(){return[Game.PLAY_GENERATED,Game.PLAY_EDITED,Game.EDIT_PUZZLE,Game.MAIN_SCREEN]}toString(){return this.name}equals(e){return null!==e&&this.ordinal===e.ordinal}_load(e){this._boardHistory.clear(),this._moveHistory.clear(),this._solution=new MoveHistory,this._solutionReveality=!1,this._selectedSquare=null,clearArray(this._targetSquares),this._rules.kingCapturable=e._selectedKingCapturable,this._board.load(e._board),this._board.removeReversedPawns();try{this._solution=this._board.solution(this._rules)}catch(e){this._snackbar.contentNormal(Snackbar.MESSAGE06,Colour.SNACKBAR_RED)}}_loadRandomly(){this._boardHistory.clear(),this._moveHistory.clear(),this._solution=new MoveHistory,this._solutionReveality=!1,this._selectedSquare=null,clearArray(this._targetSquares),this._rules.kingCapturable=KingCapturable.randomInstance(),this._puzzleNumber++,this._board.load(Game._GENERATOR.generate(this._rules,PuzzleNumberLimit.targetNumPieces(this._puzzleNumber),this._solution))}static get DESCRIPTION_MESSAGE(){return Game._DESCRIPTION_MESSAGE}snackbarContent(){return this._snackbar.content()}pieceAt(e){var a=this._board.pieceAt(e);if(null===a)return Colour.TRANSPARENT.abbreviation;let t=Colour.CHESS_PIECE_WHITE;return e.equals(this._selectedSquare)?t=Colour.CHESS_PIECE_GREEN:this._targetSquares.includes(e)&&(t=Colour.CHESS_PIECE_RED),""+t.abbreviation+a.message}rulesMessage(){return"적용 규칙: "+this._rules.kingCapturable.message}moveHistoryMessageLeft(){return this._moveHistory.toMessageLeft()}moveHistoryMessageRight(){return this._moveHistory.toMessageRight()}solutionMessageLeft(){return this._solutionReveality?null===this._solution?Snackbar.MESSAGE00:this._solution.isEmpty()?Snackbar.MESSAGE06:this._solution.toMessageLeft():""}solutionMessageRight(){return!this._solutionReveality||null===this._solution?"":this._solution.toMessageRight()}buttonAlphaMessageObject(){switch(this.ordinal){case Game.PLAY_GENERATED.ordinal:case Game.PLAY_EDITED.ordinal:return ButtonMessage.OBJECT00;case Game.EDIT_PUZZLE.ordinal:return ButtonMessage.OBJECT07;case Game.MAIN_SCREEN.ordinal:return ButtonMessage.OBJECT09}return ButtonMessage.OBJECT11}buttonBetaMessageObject(){switch(this.ordinal){case Game.PLAY_GENERATED.ordinal:case Game.PLAY_EDITED.ordinal:break;case Game.EDIT_PUZZLE.ordinal:return ButtonMessage.OBJECT11;case Game.MAIN_SCREEN.ordinal:return ButtonMessage.OBJECT10}return null===this._solution?ButtonMessage.OBJECT03:this._board.hasMultiplePieces()?ButtonMessage.OBJECT01:Game.PLAY_GENERATED.equals(this)?ButtonMessage.OBJECT02:ButtonMessage.OBJECT03}buttonGammaMessageObject(){switch(this.ordinal){case Game.PLAY_GENERATED.ordinal:case Game.PLAY_EDITED.ordinal:return this._solutionReveality?ButtonMessage.OBJECT05:ButtonMessage.OBJECT04;case Game.EDIT_PUZZLE.ordinal:case Game.MAIN_SCREEN.ordinal:return ButtonMessage.OBJECT11}return ButtonMessage.OBJECT11}buttonDeltaMessageObject(){switch(this.ordinal){case Game.PLAY_GENERATED.ordinal:case Game.PLAY_EDITED.ordinal:return ButtonMessage.OBJECT06;case Game.EDIT_PUZZLE.ordinal:return ButtonMessage.OBJECT08;case Game.MAIN_SCREEN.ordinal:return ButtonMessage.OBJECT11}return ButtonMessage.OBJECT11}isKingCannotBeCapturedSelected(){return KingCapturable.KING_CANNOT_BE_CAPTURED.equals(this._selectedKingCapturable)}isKingCanBeCapturedSelected(){return KingCapturable.KING_CAN_BE_CAPTURED.equals(this._selectedKingCapturable)}isKingSelected(){return Piece.KING.equals(this._selectedPiece)}isQueenSelected(){return Piece.QUEEN.equals(this._selectedPiece)}isRookSelected(){return Piece.ROOK.equals(this._selectedPiece)}isBishopSelected(){return Piece.BISHOP.equals(this._selectedPiece)}isKnightSelected(){return Piece.KNIGHT.equals(this._selectedPiece)}isPawnSelected(){return Piece.PAWN.equals(this._selectedPiece)}isEraseSelected(){return null===this._selectedPiece}static currentGame(){return Game._currentGame}demoplay(){if(this==Game.MAIN_SCREEN){var e=currentTime(),a=e-this._demoplayRecentTime;if(!(a<Game._DEMOPLAY_DELAY)){if(this._board.hasMultiplePieces())try{var t=this._board.nextMove(this._rules);null===t?this._loadRandomly():this._board.moveByHint(t,this._boardHistory,this._moveHistory)}catch(e){this._loadRandomly()}else this._loadRandomly();a>=2*Game._DEMOPLAY_DELAY?this._demoplayRecentTime=e:this._demoplayRecentTime+=Game._DEMOPLAY_DELAY}}}snackbarContentNormal(e,a){this._snackbar.contentNormal(e,a)}snackbarContentShort(e,a){this._snackbar.contentShort(e,a)}clearSnackbar(){this._snackbar.clear()}input(e){switch(e.ordinal){case Input.SQUARE_A1.ordinal:case Input.SQUARE_A2.ordinal:case Input.SQUARE_A3.ordinal:case Input.SQUARE_A4.ordinal:case Input.SQUARE_B1.ordinal:case Input.SQUARE_B2.ordinal:case Input.SQUARE_B3.ordinal:case Input.SQUARE_B4.ordinal:case Input.SQUARE_C1.ordinal:case Input.SQUARE_C2.ordinal:case Input.SQUARE_C3.ordinal:case Input.SQUARE_C4.ordinal:case Input.SQUARE_D1.ordinal:case Input.SQUARE_D2.ordinal:case Input.SQUARE_D3.ordinal:case Input.SQUARE_D4.ordinal:this._inputSquare(e.equivalentSquare());break;case Input.BUTTON_ALPHA.ordinal:this._inputButtonAlpha();break;case Input.BUTTON_BETA.ordinal:this._inputButtonBeta();break;case Input.BUTTON_GAMMA.ordinal:this._inputButtonGamma();break;case Input.BUTTON_DELTA.ordinal:this._inputButtonDelta();break;case Input.PIECE_KING.ordinal:case Input.PIECE_QUEEN.ordinal:case Input.PIECE_ROOK.ordinal:case Input.PIECE_BISHOP.ordinal:case Input.PIECE_KNIGHT.ordinal:case Input.PIECE_PAWN.ordinal:case Input.PIECE_ERASE.ordinal:case Input.PIECE_REVERSED_PAWN.ordinal:this._inputPiece(e.equivalentPiece());break;case Input.KING_CANNOT_BE_CAPTURED.ordinal:case Input.KING_CAN_BE_CAPTURED.ordinal:this._inputKingCapturable(e.equivalentKingCapturable())}}_inputSquare(e){if(null!==e)switch(this.ordinal){case Game.PLAY_GENERATED.ordinal:case Game.PLAY_EDITED.ordinal:if(null===this._selectedSquare){if(this._board.isEmptyAt(e))return;this._selectedSquare=e;var a,t=this._board.possibleCapturingMovesFrom(this._selectedSquare,this._rules);clearArray(this._targetSquares);for(a of t)this._targetSquares.push(a.to)}else{if(e.equals(this._selectedSquare))return this._selectedSquare=null,void clearArray(this._targetSquares);t=this._board.moveByPlayer(this._selectedSquare,e,this._rules,this._boardHistory,this._moveHistory);null!==t&&this._snackbar.contentNormal(t.message,Colour.SNACKBAR_RED),this._selectedSquare=null,clearArray(this._targetSquares),this._board.hasSinglePiece()&&this._snackbar.contentNormal(Snackbar.MESSAGE01,Colour.SNACKBAR_GREEN)}break;case Game.EDIT_PUZZLE.ordinal:null===this._selectedPiece?this._board.removePieceAt(e):this._board.putPieceAt(e,this._selectedPiece);break;case Game.MAIN_SCREEN.ordinal:}}_inputButtonAlpha(){switch(this.ordinal){case Game.PLAY_GENERATED.ordinal:case Game.PLAY_EDITED.ordinal:this._board.undo(this._boardHistory,this._moveHistory)||this._snackbar.contentNormal(Snackbar.MESSAGE02,Colour.SNACKBAR_RED),this._selectedSquare=null,clearArray(this._targetSquares);break;case Game.EDIT_PUZZLE.ordinal:1<this._board.numPieces()?(Game.PLAY_EDITED._load(Game.EDIT_PUZZLE),this._snackbar.clear(),Game._currentGame=Game.PLAY_EDITED):this._snackbar.contentNormal(Snackbar.MESSAGE03,Colour.SNACKBAR_RED);break;case Game.MAIN_SCREEN.ordinal:Game.PLAY_GENERATED._board.isEmpty()&&Game.PLAY_GENERATED._loadRandomly(),this._snackbar.clear(),Game._currentGame=Game.PLAY_GENERATED}}_inputButtonBeta(){switch(this.buttonBetaMessageObject().ordinal){case ButtonMessage.OBJECT01.ordinal:try{var e=this._board.nextMove(this._rules);null===e?this._snackbar.contentNormal(Snackbar.MESSAGE00,Colour.SNACKBAR_RED):this._board.moveByHint(e,this._boardHistory,this._moveHistory)}catch(e){this._snackbar.contentNormal(Snackbar.MESSAGE06,Colour.SNACKBAR_RED)}this._selectedSquare=null,clearArray(this._targetSquares);break;case ButtonMessage.OBJECT02.ordinal:this._loadRandomly();break;case ButtonMessage.OBJECT03.ordinal:case ButtonMessage.OBJECT10.ordinal:this._snackbar.clear(),Game._currentGame=Game.EDIT_PUZZLE}}_inputButtonGamma(){switch(this.ordinal){case Game.PLAY_GENERATED.ordinal:case Game.PLAY_EDITED.ordinal:this._solutionReveality=!this._solutionReveality;break;case Game.EDIT_PUZZLE.ordinal:case Game.MAIN_SCREEN.ordinal:}}_inputButtonDelta(){switch(this.ordinal){case Game.PLAY_GENERATED.ordinal:case Game.PLAY_EDITED.ordinal:case Game.EDIT_PUZZLE.ordinal:this._snackbar.clear(),Game._currentGame=Game.MAIN_SCREEN;break;case Game.MAIN_SCREEN.ordinal:}}_inputPiece(e){switch(this.ordinal){case Game.EDIT_PUZZLE.ordinal:this._selectedPiece=e;break;case Game.PLAY_GENERATED.ordinal:case Game.PLAY_EDITED.ordinal:case Game.MAIN_SCREEN.ordinal:}}_inputKingCapturable(e){if(null!==e)switch(this.ordinal){case Game.EDIT_PUZZLE.ordinal:this._selectedKingCapturable=e;break;case Game.PLAY_GENERATED.ordinal:case Game.PLAY_EDITED.ordinal:case Game.MAIN_SCREEN.ordinal:}}}Game.PLAY_GENERATED=new Game(0,"PLAY_GENERATED",0),Game.PLAY_EDITED=new Game(1,"PLAY_EDITED",Number.MIN_SAFE_INTEGER),Game.EDIT_PUZZLE=new Game(2,"EDIT_PUZZLE",Number.MIN_SAFE_INTEGER),Game.MAIN_SCREEN=new Game(3,"MAIN_SCREEN",PuzzleNumberLimit.PIECE_3_LIMIT.limit),Game._GENERATOR=new Generator,Game._currentGame=Game.MAIN_SCREEN,Game._DEMOPLAY_DELAY=1500,Game._DESCRIPTION_MESSAGE=`* 체스 기물을 움직여서 기물 하나만 남게 만드세요.
    
    * 모든 기물 움직임은 잡기 움직임이어야 합니다.
    
    * ${ButtonMessage.OBJECT09.message} 버튼을 클릭하여 임의의 퍼즐을 시도할 수 있고, ${ButtonMessage.OBJECT10.message} 버튼을 클릭하여 퍼즐을 만들고 시험해 볼 수 있습니다.`;